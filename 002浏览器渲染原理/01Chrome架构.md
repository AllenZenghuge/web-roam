# Chrome架构理解与学习

无论你是想要设计高性能 Web 应用，还是要优化现有的 Web 应用，你都需要了解浏览器中的网络流程、页面渲染过程，JavaScript 执行流程，以及 Web 安全理论，而这些功能是分散在浏览器的各个功能组件中的，比较多、比较散，要怎样学习才能掌握呢？通过浏览器的多进程架构的学习，你就可以把这些分散的知识点串起来，组成一张网，从而让自己能站在更高的维度去理解 Web 应用。



浏览器中 **Chrome**最具有代表性

![image-20200518200043866](http://picbed.sedationh.cn/image-20200518200043866.png)



## 前置知识

**进程和线程**

[进程与线程的一个简单解释](https://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html)

- 一个进程就是一个程序运行的实例，操作系统会为进程提供相关资源

- 线程是进程来启动和管理的

- 一个进程之中的多个线程之间可以共享数据

- 不同的进程之间相互隔离

- 当一个进程关闭之后，操作系统会回收进程所占用的内存。

- 进程中的任意一线程执行出错，会导致整个进程的崩溃



## Chrome的发展

1. 单进程浏览器时代
2. 多进程浏览器时代(不断变化，隔离出新的进程)
   1. **浏览器进程**。主要负责界面显示、用户交互、子进程管理，同时提供存储等功能。
   2. **渲染进程**。核心任务是将 HTML、CSS 和 JavaScript 转换为用户可以与之交互的网页，排版引擎 Blink 和 JavaScript 引擎 V8 都是运行在该进程中，默认情况下，Chrome 会为每个 Tab 标签创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱模式下。
   3. **GPU 进程**。其实，Chrome 刚开始发布的时候是没有 GPU 进程的。而 GPU 的使用初衷是为了实现 3D CSS 的效果，只是随后网页、Chrome 的 UI 界面都选择采用 GPU 来绘制，这使得 GPU 成为浏览器普遍的需求。最后，Chrome 在其多进程架构上也引入了 GPU 进程。
   4. **网络进程**。主要负责页面的网络资源加载，之前是作为一个模块运行在浏览器进程里面的，直至最近才独立出来，成为一个单独的进程。
   5. **插件进程**。主要是负责插件的运行，因插件易崩溃，所以需要通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响。
3. “**面向服务的架构**”（Services Oriented Architecture，简称**SOA**）
   1. 也就是说 Chrome 整体架构会朝向现代操作系统所采用的“面向服务的架构” 方向发展，原来的各种模块会被重构成独立的服务（Service），每个服务（Service）都可以在独立的进程中运行，访问服务（Service）必须使用定义好的接口，通过 IPC 来通信，从而**构建一个更内聚、松耦合、易于维护和扩展的系统**，更好实现 Chrome 简单、稳定、高速、安全的目标。

![image-20200518201955264](http://picbed.sedationh.cn/image-20200518201955264.png)



从发展来看浏览器越来越像一个操作系统，前端相关的生态也在不断壮大，可见趋势